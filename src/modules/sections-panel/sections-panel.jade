include ../../modules/button/button
include ../../modules/block-aside-links/block-aside-links
include ../../components/buttons/buttons
include ../../components/links/links

mixin sections-panel(data)
  - has_current_item = false
  - has_content = typeof data.content !== 'undefined'
  each item in data.nav.items
    - if (item.current === true) {current_item = item; has_current_item = true;}
  .sections-panel(class=(has_content ? "has-content" : ""))
    if data.nav
      - nav_classes = []
      - if (has_current_item) {nav_classes.push('has-current-item');}
      - if (has_content) {nav_classes.push('closed');}
      .sections-panel-nav(class=nav_classes)
        if data.nav.items.length !== 0
          ul.sections-panel-nav-items
            each item in data.nav.items
              li.sections-panel-nav-item
                a(href=item.href data-subnav-section=item.slug data-background=item.background class=(item.current ? "current" : ""))= item.text
        if data.nav.more
          - more = JSON.parse(JSON.stringify(data.nav.more)) // clone the data object
          - more.modifiers = ["action", "white", "small", "sections-panel-nav-more"]
          +button(more)
      .sections-panel-subnav#sections-panel-subnav(class=(has_current_item ? "has-current-item" : ""))
        a.sections-panel-back.sections-panel-subnav-back(href=data.base)
        .sections-panel-subnav-default(data-background=data.default.background)
          if data.default.links
            +block-aside-links(data.default.links)
          if data.default.buttons
            +buttons(data.default.buttons)
        each item in data.nav.items
          .sections-panel-subnav-section(id="subnav-#{item.slug}" data-nav-item=item.slug class=(item.current ? "current" : ""))
            if item.subnav && item.subnav.items.length !== 0
              if item.subnav.text
                .sections-panel-intro= item.subnav.text
              ul.sections-panel-subnav-items
                each subitem in item.subnav.items
                  li.sections-panel-subnav-item
                    a(href=subitem.href data-background=subitem.background data-json=subitem.json class=(subitem.current ? "current" : ""))
                      .sections-panel-subnav-item-title= subitem.title
                      .sections-panel-subnav-item-text= subitem.text
    .sections-panel-content#sections-panel-content
      a.sections-panel-back.sections-panel-content-back(href=current_item ? current_item.href : "")
      .sections-panel-content-wrapper
        if has_content
          if data.content.intro
            .sections-panel-intro= data.content.intro
          if data.content.items.length !== 0
            ul.sections-panel-content-items
              each item in data.content.items
                li.sections-panel-content-item
                  a(href=item.href)
                    .sections-panel-content-item-title= item.title
                    .sections-panel-content-item-text= item.text
          if data.content.buttons
            +buttons(data.content.buttons)
          if data.content.more_links
            +links(data.content.more_links)
